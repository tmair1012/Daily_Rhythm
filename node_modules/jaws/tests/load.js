var jaws = require("../");
var app = jaws();
var EventEmitter = require("events").EventEmitter;
var pubsub = new EventEmitter;

pubsub.on("clear", function(ok) {
  console.log("clearing cache", ok);
  return app.flush();
});

app.route("/cache-this", function(req, res) {
  var data = {
    timestamp: new Date()
  };
  res.statusCode = 200;
  res.setHeader("Content-type", "application/json");
  return res.end(JSON.stringify(data));
});

var clear = app.route("/clear-cache", function(req, res) {
  pubsub.emit("clear", true);
  res.statusCode = 200;
  return res.end("done");
}).nocache();

app.httpServer.listen(4444, function() {
  return console.log("Listening on 4444");
});
